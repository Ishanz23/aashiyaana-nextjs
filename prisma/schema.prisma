generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id          String        @id @default(cuid())
  email       String        @unique
  mobile      String        @unique
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  firstname   String
  lastname    String
  sex         String
  dob         DateTime
  nationality String
  address     String?
  password    Password?
  Reservation Reservation[]
}

model Password {
  hash   String
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Admin {
  id  String @id @default(cuid())
  email String @unique
  mobile String @unique
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  firstname   String
  lastname    String
  sex         String?
  dob         DateTime
  nationality String?
  address     String?
  password    AdminPassword?
}

model AdminPassword {
  hash   String
  adminId String @unique
  user   Admin   @relation(fields: [adminId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Guest {
  id           String         @id @default(cuid())
  firstname    String
  lastName     String
  mobile       String?        @unique
  email        String?        @unique
  RoomReserved RoomReserved[]
}

model Location {
  id          String     @id @default(cuid())
  name        String     @unique
  lat         Float
  long        Float
  state       String
  altitude    Int
  description String
  coverUrl    String
  Homestay    Homestay[]
}

model Homestay {
  id                String              @id @default(cuid())
  name              String
  address           String
  locationName      String
  location          Location            @relation(fields: [locationName], references: [name], onDelete: Cascade, onUpdate: Cascade)
  Rooms             Room[]
  Reservation       Reservation[]
  HomestayAmenities HomestayAmenities[]
  HomestayGallery   HomestayGallery[]
  
  @@index([locationName])
}

model Room {
  id              String         @id @default(cuid())
  name            String
  category        String
  maxOccupancy    Int
  toiletAttached  Boolean
  airConditioned  Boolean
  kitchenAttached Boolean
  isDorm          Boolean
  homestayId      String
  homestay        Homestay       @relation(fields: [homestayId], references: [id])
  Rate            Rate[]
  RoomReserved    RoomReserved[]
  RoomFeatures    RoomFeatures[]
  RoomGallery     RoomGallery[]

  @@index([homestayId])
}

model Rate {
  id         String  @id @default(cuid())
  headCount  Int
  tariff     Int
  refundable Boolean
  roomId     String
  room       Room    @relation(fields: [roomId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  @@index([roomId])
}

model FoodPlan {
  id           String         @id @default(cuid())
  name         String
  tariff       Decimal
  nonVeg       Boolean?
  RoomReserved RoomReserved[]

  @@unique([name, nonVeg])
}

model Reservation {
  id          String   @id @default(cuid())
  createdAt   DateTime
  modifiedAt  DateTime
  dateIn      DateTime
  dateOut     DateTime
  totalAmount Decimal
  dueAmount   Decimal
  userId      String
  homestayId  String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  homestay    Homestay @relation(fields: [homestayId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([userId])
  @@index([homestayId])
}

model RoomReserved {
  id           String   @id @default(cuid())
  pax          Int
  amount       Decimal
  status       String
  guestId      String
  roomId       String
  foodPlanId   String
  primaryGuest Guest    @relation(fields: [guestId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  room         Room     @relation(fields: [roomId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  foodPlan     FoodPlan @relation(fields: [foodPlanId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  @@index([guestId])
  @@index([roomId])
  @@index([foodPlanId])
}

model Amenity {
  id                String              @id @default(cuid())
  name              String              @unique
  description       String?
  HomestayAmenities HomestayAmenities[]
}

model Feature {
  id           String         @id @default(cuid())
  name         String         @unique
  description  String?
  RoomFeatures RoomFeatures[]
}

model HomestayAmenities {
  homestayId String
  amenityId  String
  homestay   Homestay @relation(fields: [homestayId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  amenity    Amenity  @relation(fields: [amenityId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([homestayId])
  @@index([amenityId])

  @@unique([homestayId, amenityId])
}

model RoomFeatures {
  roomId    String
  featureId String
  room      Room    @relation(fields: [roomId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  feature   Feature @relation(fields: [featureId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([roomId])
  @@index([featureId])

  @@unique([roomId, featureId])
}

model HomestayGallery {
  url         String   @id
  category    String
  description String?
  homestayId  String
  homestay    Homestay @relation(fields: [homestayId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([homestayId])
}

model RoomGallery {
  url         String  @id
  category    String
  description String?
  roomId      String
  room        Room    @relation(fields: [roomId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([roomId])
}
